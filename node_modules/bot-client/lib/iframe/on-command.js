function init ({ onBroadcast, loginInfo, broadcast }) {
  function onCommand (cb) {
    if (typeof cb !== 'function') {
      cb = () => {}
      console.log('must provide function to iframe.onCommand')
    }
    onBroadcast('iframe::message-sent', async message => {
      const userId = loginInfo.getUserId(message.teamId)
      if (message.data.from === userId) {
        return
      }
      if (message.data.botId !== userId) {
        return
      }
      const teamId = message.teamId
      const requestId = message.data.data.requestId
      const content = message.data.data
      const data = await cb({ teamId, content })
      broadcast(teamId, data, requestId)
    })
  }

  return onCommand
}

module.exports = init
