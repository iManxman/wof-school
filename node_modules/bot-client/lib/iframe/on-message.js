function init ({ onBroadcast, loginInfo }) {
  function onMessage (cb) {
    if (typeof cb !== 'function') {
      cb = () => {}
      console.log('must provide function to iframe.onMessage')
    }
    onBroadcast('iframe::message-sent', message => {
      const userId = loginInfo.getUserId(message.teamId)
      if (message.data.from === userId) {
        return
      }
      if (message.data.botId !== userId) {
        return
      }
      cb(message)
    })
  }

  return onMessage
}

module.exports = init
