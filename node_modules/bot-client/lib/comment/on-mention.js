const { path } = require('ramda')

function init ({ onBroadcast, loginInfo }) {
  function onMention (cb) {
    if (typeof cb !== 'function') {
      cb = () => {}
      console.log('WARN', 'must provide function to comment.onMention')
    }
    onBroadcast('comment::created', message => {
      const userId = loginInfo.getUserId(message.teamId)
      if (!path(['data', 'content', 'streamId'], message)) {
        return
      }
      if (!path(['data', 'content', 'to'], message)) {
        return
      }
      if (!message.data.content.to.find(id => id === userId)) {
        return
      }

      cb(message)
    })
  }

  return onMention
}

module.exports = init
